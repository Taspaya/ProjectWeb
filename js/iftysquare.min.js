const GAME_AREA_WIDTH=800,GAME_AREA_HEIGHT=500,SQUARE_SIZE=40,SQUARE_COLOR="#cc0000",SQUARE_SPEED_X=5,SQUARE_SPEED_Y=5,OBSTACLE_SPEED=2,OBSTACLE_COLOR="#187440",OBSTACLE_MIN_HEIGHT=40,OBSTACLE_MAX_HEIGHT=400,OBSTACLE_WIDTH=20,OBSTACLE_MIN_GAP=55,OBSTACLE_MAX_GAP=400,PROBABILITY_OBSTACLE=.7,FRAME_OBSTACLE=85,FPS=30,CHRONO_MSG="Time goes by...",RIGHTARROW_KEYCODE=39,LEFTARROW_KEYCODE=37,UPARROW_KEYCODE=38,DOWNARROW_KEYCODE=40;let obs,patatita=new Image,gap;patatita.src="imgs/potato.png";class SquaredForm{constructor(x,y,width,height,color,imagen=null){this.x=x,this.y=y,this.width=width,this.height=height,this.color=color,this.speedX=0,this.speedY=0,this.imagen=imagen}setSpeedX(speedX){this.speedX=speedX}setSpeedY(speedY){this.speedY=speedY}render(ctx){null==this.imagen?(ctx.fillStyle=this.color,ctx.fillRect(this.x,this.y,this.width,this.height)):ctx.drawImage(this.imagen,this.x,this.y,this.width,this.height)}move(){this.x+=this.speedX,this.y+=this.speedY}setIntoArea(endX,endY){this.x=Math.min(Math.max(0,this.x),endX-this.width),this.y=Math.min(Math.max(0,this.y),endY-this.height)}crashWith(obj){let myleft=this.x,myright=this.x+this.width,mytop=this.y,mybottom=this.y+this.height,otherleft=obj.x,otherright=obj.x+obj.width,othertop=obj.y,otherbottom=obj.y+obj.height,crash=!0;return(mybottom<othertop||mytop>otherbottom||myright<otherleft||myleft>otherright)&&(crash=!1),crash}}class GameArea{constructor(canvas,hero,obstacles){this.canvas=canvas,this.hero=hero,this.obstacles=obstacles,this.context=null,this.interval=null,this.frameNumber=void 0}initialise(){let theDiv;this.canvas.width=800,this.canvas.height=500,this.context=this.canvas.getContext("2d"),document.getElementById("gameplay").appendChild(this.canvas),this.interval=setInterval(updateGame,1e3/30),this.frameNumber=0}render(){for(const obstacle of this.obstacles)obstacle.render(this.context);this.hero.render(this.context)}clear(){this.context.clearRect(0,0,this.canvas.width,this.canvas.height)}addObstacle(obstacle){this.obstacles.push(obstacle)}removeObstacle(i){this.obstacles.splice(i,1)}}let navesita=new Image;navesita.src="imgs/nave.png";let theSquare=new SquaredForm(0,250,40,40,"#FF00CC",navesita),rightArrowPressed=!1,leftArrowPressed=!1,upArrowPressed=!1,downArrowPressed=!1,seconds,timeout,theChrono,lifes,continueGame=!0,Currentlifes=3,gameArea=new GameArea(document.createElement("canvas"),theSquare,[]);function handlerOne(event){switch(event.keyCode){case 39:rightArrowPressed||(rightArrowPressed=!0,theSquare.setSpeedX(5));break;case 37:leftArrowPressed||(leftArrowPressed=!0,theSquare.setSpeedX(-5));break;case 38:upArrowPressed||(upArrowPressed=!0,theSquare.setSpeedY(-5));break;case 40:downArrowPressed||(downArrowPressed=!0,theSquare.setSpeedY(5))}}function handlerTwo(event){switch(event.keyCode){case 39:rightArrowPressed=!1,theSquare.setSpeedX(0);break;case 37:leftArrowPressed=!1,theSquare.setSpeedX(0);break;case 38:upArrowPressed=!1,theSquare.setSpeedY(0);break;case 40:downArrowPressed=!1,theSquare.setSpeedY(0)}}function startGame(){gameArea.initialise(),gameArea.render(),window.document.addEventListener("keydown",handlerOne),window.document.addEventListener("keyup",handlerTwo),seconds=0,timeout=window.setTimeout(updateChrono,1e3),theChrono=document.getElementById("chrono"),lifes=document.getElementById("lives"),Currentlifes=3,lifes.innerHTML=Currentlifes}function updateGame(){var velo=5;let collision=!1;for(let i=0;i<gameArea.obstacles.length;i++)if(theSquare.crashWith(gameArea.obstacles[i])){collision=!0,obs=i;break}if(collision)null!=gameArea.obstacles[obs].imagen?punish():endGame();else{if(gameArea.frameNumber+=1,gameArea.frameNumber>=85&&(gameArea.frameNumber=1),1==gameArea.frameNumber){let chance;if(Math.random()<.7){let height=Math.floor(361*Math.random()+40);gap=Math.floor(346*Math.random()+55);let form=new SquaredForm(gameArea.canvas.width,0,20,height,"#187440"),niggu=new SquaredForm(gameArea.canvas.width,height+5,25,30,"#000000",patatita);niggu.patata=!0,form.setSpeedX(-2),niggu.setSpeedX(-2),seconds%2==0&&(velo*=-1),niggu.setSpeedY(velo),gameArea.addObstacle(form),gameArea.addObstacle(niggu),height+gap+40<=gameArea.canvas.height&&(form=new SquaredForm(gameArea.canvas.width,height+gap,20,gameArea.canvas.height-height-gap,"#187440"),form.setSpeedX(-2),gameArea.addObstacle(form))}}for(let i=gameArea.obstacles.length-1;i>=0;i--)gameArea.obstacles[i].move(),gameArea.obstacles[i].x+20<=0&&gameArea.removeObstacle(i),null!=gameArea.obstacles[i].imagen&&(gameArea.obstacles[i].y<=0||gameArea.obstacles[i].y>=475)&&(gameArea.obstacles[i].speedY=-1*gameArea.obstacles[i].speedY);theSquare.move(),theSquare.setIntoArea(gameArea.canvas.width,gameArea.canvas.height),gameArea.clear(),gameArea.render()}}function updateChrono(){if(continueGame){seconds++;let minutes=Math.floor(seconds/60),secondsToShow=seconds%60;theChrono.innerHTML=CHRONO_MSG+" "+String(minutes).padStart(2,"0")+":"+String(secondsToShow).padStart(2,"0"),timeout=window.setTimeout(updateChrono,1e3)}}function endGame(){continueGame=!1,clearInterval(gameArea.interval),window.document.removeEventListener("keydown",handlerOne),window.document.removeEventListener("keyup",handlerTwo)}function punish(){seconds-=15,gameArea.removeObstacle(obs),Currentlifes-=1,lifes.innerHTML=Currentlifes,setTimeout(restartGame(),1e3),seconds<0&&(seconds=0),Currentlifes<0&&endGame()}function restartGame(){for(let i=gameArea.obstacles.length-1;i>=0;i--)gameArea.removeObstacle(i);theSquare.y=250,theSquare.x=0}window.onload=startGame;